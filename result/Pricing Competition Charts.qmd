---
title: "Pricing Competition Charts"
author: "Aheer Sravon"
format: pdf
execute: 
  echo: false
editor: visual
---

# Libraries

```{r}
library(ggplot2)
library(tidyverse)
```

# DataFrame

```{r}
df <- read.csv("./all_tables.csv")

df %>% 
  sample_n(10)
```

```{r}
df_long <- df %>%
  pivot_longer(
    cols = c(Agent1_Delta, Agent2_Delta, Agent1_RPDI, Agent2_RPDI),
    names_to = c("Agent", ".value"),
    names_sep = "_",
    values_to = c("Delta", "RPDI")
  ) %>%
  mutate(Agent = ifelse(Agent == "Agent1", "Agent 1", "Agent 2"),
         Shock = factor(Shock, levels = c("0", "A", "B", "C"),
                       labels = c("No Shock", "Shock A", "Shock B", "Shock C"))) %>%
  mutate(
    Algorithm = case_when(
      str_detect(Matchup, "^Q vs") ~ "qlearning",
      str_detect(Matchup, "^DQN vs") ~ "dqn", 
      str_detect(Matchup, "^PSO vs") ~ "pso",
      str_detect(Matchup, "^DDPG vs") ~ "ddpg",
      TRUE ~ "other"
    )
  )
```

# Delta vs RPDI Scatter Plots

Visualize the relationship between profit extraction (Delta) and price elevation (RPDI).

## Logit

```{r}

logit_plot <- df_long %>%
  filter(Model == "LOGIT") %>%
  ggplot(aes(x = RPDI, y = Delta, color = Shock, shape = Algorithm)) +
  geom_point(size = 3, alpha = 0.8) +
  labs(
    title = "LOGIT Model: Relationship between Profit Extraction (Delta) and Price Elevation (RPDI)",
    x = "Relative Price Difference Index (RPDI)",
    y = "Delta",
    color = "Shock Condition",
    shape = "Algorithm"
  ) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", 
              color = "black", linewidth = 0.5, alpha = 0.7) +
  annotate("text", x = -1.5, y = -0.1, label = "Delta = RPDI Line", 
           color = "black", size = 3.5, hjust = 0, vjust = 0, angle = 14) +
  xlim(-2.5, 1.75) + ylim(-8, 3) +
  scale_color_brewer(palette = "Set1") +
  scale_shape_manual(
    values = c(
      "qlearning" = 16,    # circle
      "dqn" = 15,          # square
      "pso" = 17,          # triangle
      "ddpg" = 18          # diamond
    ),
    labels = c(
      "qlearning" = "Q-learning",
      "dqn" = "DQN",
      "pso" = "PSO", 
      "ddpg" = "DDPG"
    )
  )

logit_plot <- logit_plot + theme_set(theme_minimal(base_family = "serif", base_size = 12))

ggsave("logit_plot.jpg", logit_plot, 
       width = 200, height = 150, units = "mm", dpi = 300)

logit_plot

```

## Hotelling

```{r}
hotelling_plot <- df_long %>%
  filter(Model == "HOTELLING") %>%
  ggplot(aes(x = RPDI, y = Delta, color = Shock, shape = Algorithm)) +
  geom_point(size = 3, alpha = 0.8) +
  labs(
    title = "Hotelling Model: Relationship between Profit Extraction (Delta) and Price Elevation (RPDI)",
    x = "Relative Price Difference Index (RPDI)",
    y = "Delta",
    color = "Shock Condition",
    shape = "Algorithm"
  ) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", 
              color = "black", linewidth = 0.5, alpha = 0.7) +
  annotate("text", x = 0.7, y = 0.8, label = "Delta = RPDI Line", 
           color = "black", size = 3.5, hjust = 0, vjust = 0, angle = 20) +
  xlim(0, 1) + ylim(-0.5, 1.25) +
  scale_color_brewer(palette = "Set1") +
  scale_shape_manual(
    values = c(
      "qlearning" = 16,    # circle
      "dqn" = 15,          # square
      "pso" = 17,          # triangle
      "ddpg" = 18          # diamond
    ),
    labels = c(
      "qlearning" = "Q-learning",
      "dqn" = "DQN",
      "pso" = "PSO", 
      "ddpg" = "DDPG"
    )
  )

hotelling_plot <- hotelling_plot + theme_set(theme_minimal(base_family = "serif", base_size = 12))

ggsave("hotelling_plot.jpg", hotelling_plot, 
       width = 200, height = 150, units = "mm", dpi = 300)

hotelling_plot
```

## Linear

```{r}

```

# Shock Impact Across Market Structures

# Price Stability vs Benchmark Shift (Logit)
